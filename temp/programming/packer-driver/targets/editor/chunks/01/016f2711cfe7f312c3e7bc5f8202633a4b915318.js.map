{"version":3,"sources":["file:///Users/jordiawang/Developer/cocos-3.x-demo/assets/Script/WolfRun/WolfController.ts"],"names":["_decorator","Component","Node","Vec3","BoxCollider","AudioSource","CCFloat","GlobalStore","ccclass","property","WolfController","leftDown","rightDown","newPosition","onLeftTouchStart","evt","propagationStopped","node","setRotationFromEuler","rorateAngle","onLeftTouchEnd","onRightTouchStart","onRightTouchEnd","onCollisionEnter","otherCollider","name","enabled","getComponent","stop","setData","onGameStatusChange","eventData","key","data","play","start","bindEvent","onDestory","offEvent","leftButton","on","EventType","TOUCH_START","TOUCH_END","rightButton","off","reset","setPosition","update","deltaTime","gameStatus","getPosition","z","forwardSpeed","x","sideSpeed"],"mappings":"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","sourcesContent":["import {\n  _decorator,\n  Component,\n  Node,\n  Vec3,\n  input,\n  Input,\n  math,\n  RigidBody,\n  BoxCollider,\n  ICollisionEvent,\n  EventTouch,\n  AudioClip,\n  AudioSource,\n  CCFloat,\n} from 'cc';\nimport GlobalStore from './GlobalStore';\nconst { ccclass, property } = _decorator;\n\n@ccclass('WolfController')\nexport class WolfController extends Component {\n  @property(CCFloat)\n  forwardSpeed: number = 0;\n\n  @property(CCFloat)\n  sideSpeed: number = 0;\n\n  @property(CCFloat)\n  rorateAngle: number = 0;\n\n  @property(Node)\n  leftButton: Node = null;\n\n  @property(Node)\n  rightButton: Node = null;\n\n  leftDown: boolean = false;\n\n  rightDown: boolean = false;\n\n  newPosition: Vec3 = new Vec3();\n\n  start() {\n    this.bindEvent();\n  }\n\n  onDestory() {\n    this.offEvent();\n  }\n\n  bindEvent() {\n    this.leftButton.on(Node.EventType.TOUCH_START, this.onLeftTouchStart);\n\n    this.leftButton.on(Node.EventType.TOUCH_END, this.onLeftTouchEnd);\n\n    this.rightButton.on(Node.EventType.TOUCH_START, this.onRightTouchStart);\n\n    this.rightButton.on(Node.EventType.TOUCH_END, this.onRightTouchEnd);\n\n    this.node.getComponent(BoxCollider).on('onCollisionEnter', this.onCollisionEnter);\n\n    GlobalStore.on('dataChange', this.onGameStatusChange);\n  }\n\n  offEvent() {\n    this.leftButton.off(Node.EventType.TOUCH_START, this.onLeftTouchStart);\n\n    this.leftButton.off(Node.EventType.TOUCH_END, this.onLeftTouchEnd);\n\n    this.rightButton.off(Node.EventType.TOUCH_START, this.onRightTouchStart);\n\n    this.rightButton.off(Node.EventType.TOUCH_END, this.onRightTouchEnd);\n\n    this.node.getComponent(BoxCollider).off('onCollisionEnter', this.onCollisionEnter);\n  }\n\n  onLeftTouchStart = (evt: EventTouch) => {\n    evt.propagationStopped = true;\n\n    this.leftDown = true;\n    this.node.setRotationFromEuler(new Vec3(0, this.rorateAngle, 0));\n  };\n\n  onLeftTouchEnd = (evt: EventTouch) => {\n    evt.propagationStopped = true;\n\n    this.leftDown = false;\n    this.node.setRotationFromEuler(new Vec3(0, 0, 0));\n  };\n\n  onRightTouchStart = (evt: EventTouch) => {\n    evt.propagationStopped = true;\n\n    this.rightDown = true;\n    this.node.setRotationFromEuler(new Vec3(0, -this.rorateAngle, 0));\n  };\n\n  onRightTouchEnd = (evt: EventTouch) => {\n    evt.propagationStopped = true;\n\n    this.rightDown = false;\n    this.node.setRotationFromEuler(new Vec3(0, 0, 0));\n  };\n\n  onCollisionEnter = (evt: ICollisionEvent) => {\n    if (evt.otherCollider.node.name === 'Obstacale') {\n      this.enabled = false;\n      this.getComponent(AudioSource).stop();\n      GlobalStore.setData('gameStatus', 2);\n    }\n  };\n\n  onGameStatusChange = eventData => {\n    if (eventData.key === 'gameStatus' && eventData.data === 1) {\n      this.getComponent(AudioSource).play();\n    }\n  };\n\n  reset() {\n    this.enabled = true;\n    this.node.setPosition(new Vec3(0, 0.5, -19));\n  }\n\n  update(deltaTime: number) {\n    if (GlobalStore.data.gameStatus === 1) {\n      this.newPosition = this.node.getPosition();\n      this.newPosition.z += deltaTime * this.forwardSpeed;\n\n      if (this.leftDown) {\n        this.newPosition.x += deltaTime * this.sideSpeed;\n      }\n\n      if (this.rightDown) {\n        this.newPosition.x -= deltaTime * this.sideSpeed;\n      }\n\n      if (this.newPosition.x >= 4.8) {\n        this.newPosition.x = 4.8;\n      } else if (this.newPosition.x <= -4.8) {\n        this.newPosition.x = -4.8;\n      }\n\n      this.node.setPosition(this.newPosition);\n    }\n  }\n}\n"]}