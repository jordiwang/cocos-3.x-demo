{"version":3,"sources":["file:///Users/jordiawang/Developer/cocos-3.x-demo/assets/Script/WolfRun/BlockController.ts"],"names":["_decorator","Component","Node","Prefab","instantiate","CCInteger","GlobalStore","ccclass","property","BlockController","blockTotal","isLoadBlock","lastBlock","onGameStatusChange","eventData","key","data","node","removeAllChildren","loadBlock","start","on","onDestory","off","i","blockNumber","blockNode","block","setPosition","addChild","removeBlock","removeChild","children","update","deltaTime","gameStatus","nowPosition","wolf","position","z","Math","floor"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,S,OAAAA,S;;AACpDC,MAAAA,W;;;;;;;;;OACD;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBR,U;;iCAGjBS,e,WADZF,OAAO,CAAC,iBAAD,C,UAELC,QAAQ,CAACN,IAAD,C,UAGRM,QAAQ,CAACL,MAAD,C,UAGRK,QAAQ,CAACH,SAAD,C,2BARX,MACaI,eADb,SACqCR,SADrC,CAC+C;AAAA;AAAA;;AAAA;;AAAA;;AAAA;;AAAA,eAU7CS,UAV6C,GAUxB,CAVwB;AAAA,eAY7CC,WAZ6C,GAYtB,KAZsB;AAAA,eAc7CC,SAd6C,GAczB,CAdyB;;AAAA,eA0B7CC,kBA1B6C,GA0BxBC,SAAS,IAAI;AAChC,gBAAIA,SAAS,CAACC,GAAV,KAAkB,YAAtB,EAAoC;AAClC,kBAAID,SAAS,CAACE,IAAV,KAAmB,CAAvB,EAA0B;AACxB,qBAAKC,IAAL,CAAUC,iBAAV;AACA,qBAAKR,UAAL,GAAkB,CAAlB;AACA,qBAAKE,SAAL,GAAiB,CAAjB;AACA,qBAAKO,SAAL;AACD;AACF;AACF,WAnC4C;AAAA;;AAgB7CC,QAAAA,KAAK,GAAG;AACN,eAAKD,SAAL;AAEA;AAAA;AAAA,0CAAYE,EAAZ,CAAe,YAAf,EAA6B,KAAKR,kBAAlC;AACD;;AAEDS,QAAAA,SAAS,GAAG;AACV;AAAA;AAAA,0CAAYC,GAAZ,CAAgB,YAAhB,EAA8B,KAAKV,kBAAnC;AACD;;AAaDM,QAAAA,SAAS,GAAG;AACV,eAAKR,WAAL,GAAmB,IAAnB;;AAEA,eAAK,IAAIa,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKC,WAAzB,EAAsCD,CAAC,EAAvC,EAA2C;AACzC,kBAAME,SAAS,GAAGtB,WAAW,CAAC,KAAKuB,KAAN,CAA7B;AACAD,YAAAA,SAAS,CAACE,WAAV,CAAsB,CAAtB,EAAyB,CAAzB,EAA4B,KAAK,KAAKlB,UAAtC;AACA,iBAAKA,UAAL,IAAmB,CAAnB;AACA,iBAAKO,IAAL,CAAUY,QAAV,CAAmBH,SAAnB;AACD;;AAED,eAAKf,WAAL,GAAmB,KAAnB;AACD;;AAEDmB,QAAAA,WAAW,GAAG;AACZ,eAAKb,IAAL,CAAUc,WAAV,CAAsB,KAAKd,IAAL,CAAUe,QAAV,CAAmB,CAAnB,CAAtB;AACD;;AAEDC,QAAAA,MAAM,CAACC,SAAD,EAAoB;AACxB,cAAI;AAAA;AAAA,0CAAYlB,IAAZ,CAAiBmB,UAAjB,KAAgC,CAApC,EAAuC;AACrC,kBAAMC,WAAW,GAAG,KAAKC,IAAL,CAAUC,QAAV,CAAmBC,CAAnB,GAAuB,EAA3C;;AAEA,gBAAI,CAAC,KAAK5B,WAAN,IAAqB,KAAKD,UAAL,GAAkB,EAAlB,GAAuB0B,WAAvB,IAAsC,EAA/D,EAAmE;AACjE,mBAAKjB,SAAL;AACD;;AAED,gBAAIqB,IAAI,CAACC,KAAL,CAAWL,WAAW,GAAG,EAAzB,IAA+B,KAAKxB,SAApC,KAAkD,CAAtD,EAAyD;AACvD,mBAAKkB,WAAL;AACA,mBAAKlB,SAAL,IAAkB,CAAlB;AACD;AACF;AACF;;AAnE4C,O;;;;;iBAEhC,I;;;;;;;iBAGG,I;;;;;;;iBAGM,C","sourcesContent":["import { _decorator, Component, Node, Prefab, instantiate, CCInteger } from 'cc';\nimport GlobalStore from './GlobalStore';\nconst { ccclass, property } = _decorator;\n\n@ccclass('BlockController')\nexport class BlockController extends Component {\n  @property(Node)\n  wolf: Node = null;\n\n  @property(Prefab)\n  block: Prefab = null;\n\n  @property(CCInteger)\n  blockNumber: number = 0;\n\n  blockTotal: number = 0;\n\n  isLoadBlock: boolean = false;\n\n  lastBlock: number = 0;\n\n  start() {\n    this.loadBlock();\n\n    GlobalStore.on('dataChange', this.onGameStatusChange);\n  }\n\n  onDestory() {\n    GlobalStore.off('dataChange', this.onGameStatusChange);\n  }\n\n  onGameStatusChange = eventData => {\n    if (eventData.key === 'gameStatus') {\n      if (eventData.data === 1) {\n        this.node.removeAllChildren();\n        this.blockTotal = 0;\n        this.lastBlock = 0;\n        this.loadBlock();\n      }\n    }\n  };\n\n  loadBlock() {\n    this.isLoadBlock = true;\n\n    for (let i = 0; i < this.blockNumber; i++) {\n      const blockNode = instantiate(this.block);\n      blockNode.setPosition(0, 0, 40 * this.blockTotal);\n      this.blockTotal += 1;\n      this.node.addChild(blockNode);\n    }\n\n    this.isLoadBlock = false;\n  }\n\n  removeBlock() {\n    this.node.removeChild(this.node.children[0]);\n  }\n\n  update(deltaTime: number) {\n    if (GlobalStore.data.gameStatus === 1) {\n      const nowPosition = this.wolf.position.z + 19;\n\n      if (!this.isLoadBlock && this.blockTotal * 40 - nowPosition <= 60) {\n        this.loadBlock();\n      }\n\n      if (Math.floor(nowPosition / 40) - this.lastBlock === 1) {\n        this.removeBlock();\n        this.lastBlock += 1;\n      }\n    }\n  }\n}\n"]}